<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card Matching - Game</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="shortcut icon" href="/ico" type="image/x-icon">
    <!-- GSAP for smooth animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
     <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-image: url('https://cdnjs.cloudflare.com/ajax/libs/placeholders/4.0.0/img/placeholder.png');
            background-size: cover;
            background-attachment: fixed;
        }
        .japanese {
            font-family: 'Noto Sans JP', sans-serif;
        }
        .card {
            transition: all 0.4s ease;
            transform-style: preserve-3d;
            perspective: 1000px;
        }
        .card-inner {
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
       
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-face {
            backface-visibility: hidden;
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 1rem;
        }
        .card-front {
            background: linear-gradient(135deg, #4338ca, #6366f1);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .card-back {
            transform: rotateY(180deg);
            background: white;
        }
        .shake {
            animation: shake 0.5s;
        }
        .match-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotateY(180deg);
            background-color: rgba(5, 150, 105, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .card.matched .match-indicator {
            opacity: 1;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
        }
        .stats-table {
            width: 100%;
            border-collapse: collapse;
        }
        .stats-table th, .stats-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        .stats-table th {
            background-color: #f3f4f6;
        }
        .cherry-blossom {
            position: absolute;
            width: 15px;
            height: 15px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23fda4af" d="M12 1l3 5h-6l3-5zm-6 6h6l-3 5 3-5h6l-3 5 3-5 3 5-3 5 3-5v6l-5-3 5 3h-6l3-5-3 5h-6l3-5-3 5-3-5 3-5-3 5v-6l5 3-5-3z"/></svg>');
            background-size: contain;
            pointer-events: none;
            opacity: 0.7;
            z-index: 9999;
        }
        .card-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 10px;

        }
        .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #f2f2f3;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .progress-container {
      width: 250px;
      height: 5px;
      background-color: #4b4f55;
      border-radius: 999px;
      margin-top: 20px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      background-color: #1473f8;
      border-radius: 999px;
    }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 to-purple-50 min-h-screen">
    

<nav class="bg-white border-gray-200 dark:bg-gray-900">
  <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
    <a href="" class="flex items-center space-x-3 rtl:space-x-reverse">
        <span class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white">Matching Cards</span>
    </a>
    <button data-collapse-toggle="navbar-default" type="button" class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-default" aria-expanded="false">
        <span class="sr-only">Open main menu</span>
        <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"/>
        </svg>
    </button>
    <div class="hidden w-full md:block md:w-auto" id="navbar-default">
      <ul class="font-medium flex flex-col p-4 md:p-0 mt-4 border border-gray-100 rounded-lg bg-gray-50 md:flex-row md:space-x-8 rtl:space-x-reverse md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700">
        <li>
          <a href="/" class="block py-2 px-3 text-white bg-blue-700 rounded-sm md:bg-transparent md:text-blue-700 md:p-0 dark:text-white md:dark:text-blue-500" aria-current="page">Home</a>
        </li>
        <li>
          <a href="/quiz-aisatsu" class="block py-2 px-3 text-gray-900 rounded-sm hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent">Quiz</a>
        </li>
     
      </ul>
    </div>
  </div>
</nav>

    <!-- Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="text-center mb-6">
    </div>
    <h1 class="text-lg font-bold text-blue-600 mb-2">Welcome to Hirakana Matching Cards</h1>
    <div class="text-green-500 text-lg font-medium mb-3">Loading... <span id="progressText">0%</span></div>
    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
    </div>
  </div>
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-6">
            <h1 class="text-4xl md:text-5xl font-bold text-indigo-800 mb-2 animate__animated animate__fadeIn">
                Aisatsu<span class="text-pink-500">Kotoba</span>
            </h1>
            <p class="text-gray-600 animate__animated animate__fadeIn animate__delay-1s">Cocokkan gambar dengan kosakata bahasa Jepang yang sesuai!</p>
            <p class="text-xs text-gray-800">&copy; 2025 | Ning | Flashcards Matching Game</p>
            <div class="flex flex-wrap justify-center items-center gap-3 mt-6">
                <div class="bg-white rounded-lg shadow-lg px-4 py-2 border-l-4 border-indigo-500">
                    <span class="font-semibold text-indigo-600">Skor: </span>
                    <span id="score" class="font-bold">0</span>
                </div>
                <div class="bg-white rounded-lg shadow-lg px-4 py-2 border-l-4 border-pink-500">
                    <span class="font-semibold text-pink-600">Pasangan: </span>
                    <span id="pairs-matched">0</span>/<span id="total-pairs">0</span>
                </div>
                <div class="bg-white rounded-lg shadow-lg px-4 py-2 border-l-4 border-purple-500">
                    <span class="font-semibold text-purple-600">Waktu: </span>
                    <span id="timer" class="font-bold">00:00</span>
                </div>
            </div>
        </header>

        <!-- Game Container -->
        <div class="max-w-5xl mx-auto bg-white rounded-xl shadow-xl p-5 mb-8">
            <!-- Game Mode Controls -->
            <div class="flex justify-between items-center mb-6">
                <div class="flex gap-2">
                    <button id="easy-mode" class="px-4 py-2 bg-green-100 hover:bg-green-200 text-green-800 rounded-lg font-medium text-sm transition-all">
                        <i class="fas fa-seedling mr-1"></i>Mudah
                    </button>
                    <button id="medium-mode" class="px-4 py-2 bg-indigo-100 hover:bg-indigo-200 text-indigo-800 rounded-lg font-medium text-sm transition-all">
                        <i class="fas fa-leaf mr-1"></i>Sedang
                    </button>
                    <button id="hard-mode" class="px-4 py-2 bg-red-100 hover:bg-red-200 text-red-800 rounded-lg font-medium text-sm transition-all">
                        <i class="fas fa-fire mr-1"></i>Sulit
                    </button>
                </div>
                <div>
                    <button id="stats-btn" class="px-4 py-2 bg-yellow-100 hover:bg-yellow-200 text-yellow-800 rounded-lg font-medium text-sm transition-all">
                        <i class="fas fa-chart-line mr-1"></i>Statistik
                    </button>
                </div>
            </div>

            <!-- Game Board -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div id="game-board" class="col-span-2 md:col-span-4 grid grid-cols-2 sm:grid-cols-4 gap-3"></div>
            </div>

            <!-- Controls -->
            <div class="flex justify-center gap-3">
                <button id="reset-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <i class="fas fa-sync-alt mr-2"></i>Ulangi Permainan
                </button>
                <button id="hint-btn" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500">
                    <i class="fas fa-lightbulb mr-2"></i>Petunjuk (3)
                </button>
            </div>
        </div>
    </div>

    <!-- Stats Modal -->
    <div id="stats-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full mx-4 p-6 animate__animated animate__fadeInUp">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-indigo-800">Statistik Permainan</h2>
                <button id="close-stats" class="text-gray-500 hover:text-gray-800">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-700 mb-2">Ringkasan</h3>
                <div class="grid grid-cols-3 gap-3">
                    <div class="bg-indigo-50 p-3 rounded-lg text-center">
                        <div class="text-2xl font-bold text-indigo-700" id="total-games">0</div>
                        <div class="text-xs text-gray-600">Total Main</div>
                    </div>
                    <div class="bg-green-50 p-3 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-700" id="best-score">0</div>
                        <div class="text-xs text-gray-600">Skor Terbaik</div>
                    </div>
                    <div class="bg-yellow-50 p-3 rounded-lg text-center">
                        <div class="text-2xl font-bold text-yellow-700" id="best-time">00:00</div>
                        <div class="text-xs text-gray-600">Waktu Terbaik</div>
                    </div>
                </div>
            </div>
            <div>
                <h3 class="text-lg font-semibold text-gray-700 mb-2">Riwayat Permainan</h3>
                <div class="max-h-48 overflow-y-auto">
                    <table class="stats-table">
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Mode</th>
                                <th>Skor</th>
                                <th>Waktu</th>
                            </tr>
                        </thead>
                        <tbody id="stats-table-body">
                            <!-- Data akan ditambahkan secara dynamis -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="mt-6 text-center">
                <button id="clear-stats" class="px-4 py-2 bg-red-100 hover:bg-red-200 text-red-800 rounded-lg font-medium text-sm transition-all">
                    <i class="fas fa-trash-alt mr-1"></i>Hapus Riwayat
                </button>
            </div>
        </div>
    </div>
<script>
    document.addEventListener("DOMContentLoaded", function() {
      // Check if we've already shown the loading screen
      const hasSeenLoadingScreen = localStorage.getItem("hasSeenLoadingScreen");
      
      if (!hasSeenLoadingScreen) {
        // If first visit, show loading screen
        runLoadingAnimation();
      } else {
        // If returning visitor, hide loading screen immediately
        document.getElementById("loadingScreen").style.display = "none";
      }
      
      // For demo: Button to reset the loading screen
      document.getElementById("resetButton").addEventListener("click", function() {
        localStorage.removeItem("hasSeenLoadingScreen");
        location.reload();
      });
    });
    
    function runLoadingAnimation() {
      const loadingScreen = document.getElementById("loadingScreen");
      const progressBar = document.getElementById("progressBar");
      const progressText = document.getElementById("progressText");
      
      // Simulate loading progress
      let progress = 0;
      const loadingDuration = 3; // in seconds
      const interval = 20; // update every 20ms
      const totalSteps = (loadingDuration * 1000) / interval;
      const incrementPerStep = 100 / totalSteps;
      
      // GSAP timeline for the initial animation
      const tl = gsap.timeline();
      
      tl.from("h1", {
        y: -50,
        opacity: 0,
        duration: 0.8,
        ease: "power3.out"
      })
      .from("svg", {
        scale: 0,
        opacity: 0,
        duration: 0.6,
        ease: "back.out(1.7)"
      }, "-=0.4")
      .from(".progress-container", {
        width: 0,
        opacity: 0,
        duration: 0.5,
        ease: "power2.out"
      }, "-=0.2");
      
      // Progress animation
      const progressInterval = setInterval(() => {
        progress += incrementPerStep;
        
        // Ensure we don't exceed 100%
        if (progress >= 100) {
          progress = 100;
          clearInterval(progressInterval);
          
          // Set localStorage flag once loading is completed
          localStorage.setItem("hasSeenLoadingScreen", "true");
          
          // Hide loading screen with GSAP
          gsap.to(loadingScreen, {
            opacity: 0,
            duration: 0.8,
            delay: 0.5,
            onComplete: () => {
              loadingScreen.style.display = "none";
            }
          });
        }
        
        // Update progress bar and text
        const progressValue = Math.floor(progress);
        gsap.to(progressBar, {
          width: `${progressValue}%`,
          duration: 0.1,
          ease: "none"
        });
        progressText.textContent = `${progressValue}%`;
        
      }, interval);
    }
  </script>
    <!-- SweetAlert2 for beautiful alerts -->
     <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
            // Game data
        const gameData = [
            { id: 1, image:'https://ucarecdn.com/061577d2-8a9a-4fc7-8181-dfd74ca92d5f/AISATSUGAMBAR_page0001.jpg', word:'https://ucarecdn.com/06b5db4f-f7c1-470b-b226-ddff0d09ca10/AISATSUKOSAKATA_page0001.jpg'  },
            { id: 2, image:'https://ucarecdn.com/550c1021-1661-4826-a789-021099597a38/AISATSUGAMBAR_page0003.jpg', word:'https://ucarecdn.com/4eb6fb4b-d3d4-4bb3-a00b-f011fec5d6b3/AISATSUKOSAKATA_page0003.jpg'  },
            { id: 3, image:'https://ucarecdn.com/876c93cf-7e92-4b0b-ade1-c156f31f06c2/AISATSUGAMBAR_page0002.jpg', word:'https://ucarecdn.com/aa93e7b1-896b-42d0-98d6-cac977ab22a0/AISATSUKOSAKATA_page0002.jpg'  },
            { id: 4, image:'https://ucarecdn.com/a78e4f5c-24e0-4ab2-afbb-62dee01e63bc/AISATSUGAMBAR_page0004.jpg', word:'https://ucarecdn.com/cc9febb4-9b14-4616-9516-3704a193bfc0/AISATSUKOSAKATA_page0004.jpg'  },
            { id: 5, image:'https://ucarecdn.com/bfe4dbda-1e43-4cbf-b474-2c03df7f849d/AISATSUGAMBAR_page0005.jpg', word:'https://ucarecdn.com/3f82836b-d20d-4279-bd4f-2539241bdf54/AISATSUKOSAKATA_page0005.jpg'  },
            { id: 6, image:'https://ucarecdn.com/b4560fde-4c5f-460a-bcea-806a3ebfe6fb/AISATSUGAMBAR_page0011.jpg', word:'https://ucarecdn.com/649abcd5-1f12-4bbb-b464-66e83fbe3980/AISATSUKOSAKATA_page0011.jpg'  },
            { id: 7, image:'https://ucarecdn.com/c1711a04-89b5-4df2-97d9-19ac0318ee8a/AISATSUGAMBAR_page0010.jpg', word:'https://ucarecdn.com/7683bb42-0592-46a0-a4f3-3fab35539e84/AISATSUKOSAKATA_page0010.jpg'  },
            { id: 8, image:'https://ucarecdn.com/41cddd88-951f-4a80-9bed-2bb50254ad23/AISATSUGAMBAR_page0008.jpg', word:'https://ucarecdn.com/b331b9dd-eb39-403c-900d-d49dccfe2de9/AISATSUKOSAKATA_page0008.jpg'  },
            { id: 9, image:'https://ucarecdn.com/839b3813-5ed2-40e3-9b3a-6a84d4884201/AISATSUGAMBAR_page0009.jpg', word:'https://ucarecdn.com/b7667a9a-44f4-4db5-b50b-568dace32f60/AISATSUKOSAKATA_page0009.jpg'  },
            { id: 10, image:'https://ucarecdn.com/9d676345-bcff-46ec-8c26-e24eb5a01013/AISATSUGAMBAR_page0007.jpg', word:'https://ucarecdn.com/1ca8d0a6-73b8-4f8b-b9a2-c45021d80519/AISATSUKOSAKATA_page0007.jpg'  },
            { id: 11, image:'https://ucarecdn.com/fd966cb0-cd37-49d6-b0c0-a035f737c73b/AISATSUGAMBAR_page0006.jpg', word:'https://ucarecdn.com/c5a91472-0848-49ba-b207-c4a1e0e80faf/AISATSUKOSAKATA_page0006.jpg'  }
            
        ];

        // Game state
        let selectedCards = [];
        let matchedPairs = 0;
        let score = 0;
        let canSelect = true;
        let timerInterval;
        let startTime;
        let hintCount = 3;
        let currentMode = 'medium'; // Default mode
        let currentGameData = [];
        let allCards = [];

        // DOM elements
        const gameBoardContainer = document.getElementById('game-board');
        const pairsMatchedElement = document.getElementById('pairs-matched');
        const totalPairsElement = document.getElementById('total-pairs');
        const scoreElement = document.getElementById('score');
        const timerElement = document.getElementById('timer');
        const resetBtn = document.getElementById('reset-btn');
        const hintBtn = document.getElementById('hint-btn');
        const statsBtn = document.getElementById('stats-btn');
        const statsModal = document.getElementById('stats-modal');
        const closeStatsBtn = document.getElementById('close-stats');
        const clearStatsBtn = document.getElementById('clear-stats');
        const easyModeBtn = document.getElementById('easy-mode');
        const mediumModeBtn = document.getElementById('medium-mode');
        const hardModeBtn = document.getElementById('hard-mode');

        // Mode settings
        const modes = {
            easy: { pairs: 4, hintCount: 3, timeBonus: 1.5 },
            medium: { pairs: 6, hintCount: 3, timeBonus: 1.2 },
            hard: { pairs: 8, hintCount: 3, timeBonus: 1.0 }
        };

        // Initialize game
        function initGame() {
            // Reset game state
            selectedCards = [];
            matchedPairs = 0;
            score = 0;
            canSelect = true;
            stopTimer();
            
            // Set hint count based on mode
            hintCount = modes[currentMode].hintCount;
            hintBtn.innerHTML = `<i class="fas fa-lightbulb mr-2"></i>Petunjuk (${hintCount})`;
            
            // Update UI
            pairsMatchedElement.textContent = matchedPairs;
            scoreElement.textContent = score;
            timerElement.textContent = '00:00';
            
            // Clear containers
            gameBoardContainer.innerHTML = '';
            
            // Select subset of game data based on mode
            prepareGameData();
            
            // Create cards
            createCards();
            
            // Highlight active mode button
            highlightModeButton();
        }

        function prepareGameData() {
            // Shuffle the game data
            const shuffledData = [...gameData].sort(() => Math.random() - 0.5);
            
            // Take only the number of pairs needed for the current mode
            const pairsCount = Math.min(modes[currentMode].pairs, gameData.length);
            currentGameData = shuffledData.slice(0, pairsCount);
            
            // Update total pairs display
            totalPairsElement.textContent = pairsCount;
        }

        function createCards() {
            allCards = [];
            
            // Create image cards and word cards pairs
            currentGameData.forEach(item => {
                // Create image card
                const imageCard = createCard(item, 'image');
                allCards.push(imageCard);
                
                // Create word card
                const wordCard = createCard(item, 'word');
                allCards.push(wordCard);
            });
            
            // Shuffle all cards together
            shuffleArray(allCards);
            
            // Add all cards to the board
            allCards.forEach(card => gameBoardContainer.appendChild(card));
        }

       function createCard(item, type) {
    const card = document.createElement('div');
    card.className = 'card cursor-pointer transform hover:scale-105 transition-all duration-300';
    card.dataset.id = item.id;
    card.dataset.type = type;
    
    const iconClass = type === 'image' ? 
        `<i class="fas fa-image text-white text-2xl"></i>` : 
        `<i class="fas fa-image text-white text-2xl"></i>`; // Diubah dari fas fa-language menjadi fas fa-image
    
    const backContent = type === 'image' ? 
        createImageBackContent(item) : 
        createWordBackContent(item);
    
card.innerHTML = `
<div class="card-inner relative w-full h-auto aspect-[395/570] max-w-[90%] sm:max-w-[95%] mx-auto">
    <div class="card-face card-front w-full h-full">
        <div class="absolute inset-0 flex flex-col items-center justify-center">
            <div class="w-12 h-12 rounded-full bg-white bg-opacity-20 flex items-center justify-center">
                ${iconClass}
            </div>
            <div class="absolute bottom-2 right-2 text-xs text-white font-medium">
                ${type === 'image' ? '画像' : '言葉'}
            </div>
        </div>
    </div>
    <div class="card-face card-back w-full h-full">
        ${backContent}
    </div>
</div>
`;

    
    card.addEventListener('click', () => handleCardClick(card));
    return card;
}

        function createImageBackContent(item) {
            return `
                <div class="flex flex-col items-center justify-center h-full p-3">
                    <img src="${item.image}" alt="${item.word}" class="card-image rounded-lg">
                </div>
            `;
        }

       function createWordBackContent(item) {
    return `
        <div class="flex flex-col items-center justify-center h-full p-3">
            <img src="${item.word}" alt="Word Image" class="card-image rounded-lg">
        </div>
    `;
}
        // Handle card click
        function handleCardClick(card) {
            if (!canSelect || card.classList.contains('matched') || card.classList.contains('flipped')) {
                return;
            }
            
            // Start timer on first click
            if (selectedCards.length === 0 && matchedPairs === 0) {
                startTimer();
            }
            
            // Flip the card
            card.classList.add('flipped');
            
            // Add to selected cards
            selectedCards.push(card);
            
            // If two cards are selected, check for match
            if (selectedCards.length === 2) {
                canSelect = false;
                checkForMatch();
            }
        }

        // Check if selected cards match
        function checkForMatch() {
            const [card1, card2] = selectedCards;
            
            // Cannot match two cards of the same type
            if (card1.dataset.type === card2.dataset.type) {
                setTimeout(() => {
                    resetCards([card1, card2]);
                    selectedCards = [];
                    canSelect = true;
                }, 1000);
                return;
            }
            
            // Check if IDs match
            if (card1.dataset.id === card2.dataset.id) {
                // Match found
                score += 20;
                scoreElement.textContent = score;
                
                matchedPairs++;
                pairsMatchedElement.textContent = matchedPairs;
                
                // Show match indicator
                card1.classList.add('matched');
                card2.classList.add('matched');
                
                // Add success animation and particles
                gsap.to([card1, card2], {
                    scale: 1.05,
                    duration: 0.3,
                    ease: 'power2.out',
                    onComplete: () => {
                        gsap.to([card1, card2], {
                            scale: 1,
                            duration: 0.3
                        });
                    }
                });
                
                // Create cherry blossom particles
                createCherryBlossoms(card1);
                
                selectedCards = [];
                canSelect = true;
                
                // Check if all pairs are matched
                if (matchedPairs === currentGameData.length) {
                    gameCompleted();
                }
            } else {
                // No match
                score = Math.max(0, score - 5);
                scoreElement.textContent = score;
                
                // Add shake animation
                card1.classList.add('shake');
                card2.classList.add('shake');
                
                setTimeout(() => {
                    resetCards([card1, card2]);
                    selectedCards = [];
                    canSelect = true;
                }, 1000);
            }
        }

        // Reset cards after incorrect match
        function resetCards(cards) {
            cards.forEach(card => {
                card.classList.remove('flipped', 'shake');
            });
        }

        // Game completed
        function gameCompleted() {
            const endTime = Date.now();
            const totalTime = Math.floor((endTime - startTime) / 1000);
            const formattedTime = formatTime(totalTime);
            const timeBonus = Math.floor(100 * modes[currentMode].timeBonus * (1 - totalTime / (180))); // Max 3 minutes
            const finalScore = score + Math.max(0, timeBonus);
            
            stopTimer();
            
            // Save game stats
            saveGameStats(currentMode, finalScore, formattedTime);
            
            setTimeout(() => {
                // Create confetti effect
                createConfetti();
                
                Swal.fire({
                    title: 'Selamat!',
                    html: `
                        <div class="mb-4">
                            <p class="text-lg mb-2">Kamu berhasil menyelesaikan permainan!</p>
                            <div class="grid grid-cols-2 gap-2 text-left">
                                <div class="text-gray-600">Skor Dasar:</div>
                                <div class="font-bold">${score}</div>
                                <div class="text-gray-600">Bonus Waktu:</div>
                                <div class="font-bold">+${Math.max(0, timeBonus)}</div>
                                <div class="text-gray-600">Total Waktu:</div>
                                <div class="font-bold">${formattedTime}</div>
                                <div class="text-gray-600 font-bold">SKOR AKHIR:</div>
                                <div class="font-bold text-indigo-600">${finalScore}</div>
                            </div>
                        </div>
                    `,
                    icon: 'success',
                    confirmButtonText: 'Main Lagi',
                    background: '#ffffff',
                    backdrop: `rgba(79, 70, 229, 0.6)`,
                    showDenyButton: true,
                    denyButtonText: 'Lihat Statistik'
                }).then((result) => {
                    if (result.isDenied) {
                        showStats();
                    } else {
                        initGame();
                    }
                });
            }, 500);
        }

        // Timer functions
        function startTimer() {
            startTime = Date.now();
            
            timerInterval = setInterval(() => {
                const elapsedTime = Math.floor((Date.now() - startTime) / 1000);
                timerElement.textContent = formatTime(elapsedTime);
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
            const secs = (seconds % 60).toString().padStart(2, '0');
            return `${mins}:${secs}`;
        }

        // Hint function
        function showHint() {
            if (hintCount <= 0 || matchedPairs === currentGameData.length) {
                return;
            }
            
            // Find unmatched cards
            const unmatched = allCards.filter(card => !card.classList.contains('matched'));
            
            if (unmatched.length === 0) return;
            
            // Group by ID
            const cardsByID = {};
            unmatched.forEach(card => {
                if (!cardsByID[card.dataset.id]) {
                    cardsByID[card.dataset.id] = [];
                }
                cardsByID[card.dataset.id].push(card);
            });
            
            // Find pairs where both cards are unmatched
            const fullPairs = Object.values(cardsByID).filter(pair => pair.length === 2);
            
            if (fullPairs.length === 0) return;
            
            // Pick a random pair
            const randomPair = fullPairs[Math.floor(Math.random() * fullPairs.length)];
            
            // Briefly show the cards
            randomPair.forEach(card => {
                card.classList.add('flipped');
                gsap.to(card, {
                    boxShadow: '0 0 0 3px #6366f1',
                    duration: 0.3
                });
            });
            
            setTimeout(() => {
                randomPair.forEach(card => {
                    card.classList.remove('flipped');
                    gsap.to(card, {
                        boxShadow: 'none',
                        duration: 0.3
                    });
                });
            }, 1500);
            
            // Reduce hint count
            hintCount--;
            hintBtn.innerHTML = `<i class="fas fa-lightbulb mr-2"></i>Petunjuk (${hintCount})`;
            
            // Disable button if no hints left
            if (hintCount <= 0) {
                hintBtn.classList.add('opacity-50', 'cursor-not-allowed');
                hintBtn.classList.remove('hover:bg-emerald-700');
            }
        }

        // Shuffle array (Fisher-Yates algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Visual effects
        function createCherryBlossoms(card) {
            const rect = card.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            for (let i = 0; i < 8; i++) {
                const blossom = document.createElement('div');
                blossom.className = 'cherry-blossom';
                document.body.appendChild(blossom);
                
                // Set position
                blossom.style.left = `${centerX}px`;
                blossom.style.top = `${centerY}px`;
                
                // Animate
                const angle = Math.random() * Math.PI * 2;
                const distance = 50 + Math.random() * 60;
                const duration = 0.8 + Math.random() * 0.6;
                
                gsap.to(blossom, {
                    x: Math.cos(angle) * distance,
                    y: Math.sin(angle) * distance,
                    rotation: Math.random() * 360,
                    opacity: 1,
                    duration: duration / 2,
                    ease: 'power1.out',
                    onComplete: () => {
                        gsap.to(blossom, {
                            opacity: 0,
                            duration: duration / 2,
                            delay: 0.2,
                            onComplete: () => {
                                blossom.remove();
                            }
                        });
                    }
                });
            }
        }

        function createConfetti() {
            const colors = ['#f472b6', '#6366f1', '#10b981', '#f59e0b', '#8b5cf6'];
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.top = '-10px';
                document.body.appendChild(confetti);
                
                gsap.to(confetti, {
                    y: `${window.innerHeight + 20}px`,
                    x: `${(Math.random() - 0.5) * 200}px`,
                    rotation: Math.random() * 360 * (Math.random() > 0.5 ? 1 : -1),
                    opacity: 1,
                    duration: 1.5 + Math.random() * 2,
                    delay: Math.random(),
                    ease: 'power1.out',
                    onComplete: () => confetti.remove()
                });
            }
        }

        // Stats & LocalStorage Management
       function saveGameStats(mode, score, time) {
    // Get existing stats from localStorage
    let stats = JSON.parse(localStorage.getItem('japaneseGameStats')) || { games: [] };

    // Add new game stats
    const newGame = {
        date: new Date().toISOString(),
        mode: mode,
        score: score,
        time: time
    };

    stats.games.push(newGame);

    // Update best score if needed
    if (!stats.bestScore || score > stats.bestScore) {
        stats.bestScore = score;
    }

    // Convert time string (MM:SS) to seconds
    const timeParts = time.split(':');
    const timeInSeconds = parseInt(timeParts[0]) * 60 + parseInt(timeParts[1]);

    // Update best time if needed
    if (!stats.bestTime || timeInSeconds < stats.bestTimeInSeconds) {
        stats.bestTime = time;
        stats.bestTimeInSeconds = timeInSeconds;
    }

    // Update total games count
    stats.totalGames = stats.games.length;

    // Save back to localStorage
    localStorage.setItem('japaneseGameStats', JSON.stringify(stats));
}

        function showStats() {
            // Get stats from localStorage
            const stats = JSON.parse(localStorage.getItem('japaneseGameStats')) || { 
                games: [],
                bestScore: 0,
                bestTime: '00:00',
                totalGames: 0
            };
            
            // Update stats display
            document.getElementById('total-games').textContent = stats.totalGames || 0;
            document.getElementById('best-score').textContent = stats.bestScore || 0;
            document.getElementById('best-time').textContent = stats.bestTime || '00:00';
            
            // Clear and populate table
            const tableBody = document.getElementById('stats-table-body');
            tableBody.innerHTML = '';
            
            // Sort games by date (newest first)
            const sortedGames = [...stats.games].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Add rows to table
            sortedGames.forEach(game => {
                const row = document.createElement('tr');
                
                // Format date
                const date = new Date(game.date);
                const formattedDate = `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                
                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td><span class="capitalize">${game.mode}</span></td>
                    <td>${game.score}</td>
                    <td>${game.time}</td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Show modal
            statsModal.classList.remove('hidden');
        }

        function clearStats() {
            Swal.fire({
                title: 'Hapus Statistik?',
                text: 'Semua riwayat permainan akan dihapus. Tindakan ini tidak dapat dibatalkan!',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Ya, Hapus',
                cancelButtonText: 'Batal',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    localStorage.removeItem('japaneseGameStats');
                    
                    // Update UI
                    document.getElementById('total-games').textContent = 0;
                    document.getElementById('best-score').textContent = 0;
                    document.getElementById('best-time').textContent = '00:00';
                    document.getElementById('stats-table-body').innerHTML = '';
                    
                    Swal.fire(
                        'Terhapus!',
                        'Statistik permainan telah dihapus.',
                        'success'
                    );
                }
            });
        }

        function setGameMode(mode) {
            currentMode = mode;
            initGame();
        }

        function highlightModeButton() {
            // Reset all buttons
            easyModeBtn.classList.remove('font-bold', 'ring-2', 'ring-green-400');
            mediumModeBtn.classList.remove('font-bold', 'ring-2', 'ring-indigo-400');
            hardModeBtn.classList.remove('font-bold', 'ring-2', 'ring-red-400');
            
            // Highlight selected button
            if (currentMode === 'easy') {
                easyModeBtn.classList.add('font-bold', 'ring-2', 'ring-green-400');
            } else if (currentMode === 'medium') {
                mediumModeBtn.classList.add('font-bold', 'ring-2', 'ring-indigo-400');
            } else if (currentMode === 'hard') {
                hardModeBtn.classList.add('font-bold', 'ring-2', 'ring-red-400');
            }
        }

        // Event listeners
        resetBtn.addEventListener('click', initGame);
        hintBtn.addEventListener('click', showHint);
        statsBtn.addEventListener('click', showStats);
        closeStatsBtn.addEventListener('click', () => statsModal.classList.add('hidden'));
        clearStatsBtn.addEventListener('click', clearStats);
        
        easyModeBtn.addEventListener('click', () => setGameMode('easy'));
        mediumModeBtn.addEventListener('click', () => setGameMode('medium'));
        hardModeBtn.addEventListener('click', () => setGameMode('hard'));

        // Initialize game on load
        document.addEventListener('DOMContentLoaded', () => {
            // Set up background
            document.body.style.backgroundImage = `linear-gradient(135deg, rgba(238, 242, 255, 0.9), rgba(243, 232, 255, 0.9))`;
            
            initGame();
            
            // Show welcome message
            setTimeout(() => {
                Swal.fire({
                    title: 'Selamat Datang!',
                    html: `
                        <p class="mb-4">Selamat datang di Game Matching Kartu Bahasa Jepang!</p>
                        <div class="text-left mb-4">
                            <p class="mb-2"><i class="fas fa-info-circle text-indigo-500"></i> <strong>Cara Bermain:</strong></p>
                            <ul class="space-y-1 text-sm">
                                <li>• Cocokkan kartu gambar dengan kartu kata</li>
                                <li>• Semakin cepat, semakin tinggi skormu</li>
                                <li>• Gunakan petunjuk jika kamu kesulitan</li>
                            </ul>
                        </div>
                        <p class="text-xs text-gray-500">Pilih tingkat kesulitan dan mulai bermain!</p>
                    `,
                    icon: 'info',
                    confirmButtonText: 'Mulai!',
                    background: '#ffffff',
                    backdrop: `rgba(79, 70, 229, 0.4)`
                });
            }, 500);
        });

  </script>
    </body>
    </html>

   